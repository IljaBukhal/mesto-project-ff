(()=>{"use strict";function t(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}function e(t,e,n){!function(t){return t.some(function(t){return!t.validity.valid})}(t)?(e.removeAttribute("disabled"),e.classList.remove(n.inactiveButtonClass)):(e.setAttribute("disabled","true"),e.classList.add(n.inactiveButtonClass))}function n(n,o){var r=Array.from(n.querySelectorAll(o.inputSelector)),c=n.querySelector(o.submitButtonSelector);r.forEach(function(a){t(n,a,o),e(r,c,o)})}function o(t){"Escape"===t.key&&c(document.querySelector(".popup_is-opened"))}function r(t){t.classList.add("popup_is-opened"),document.addEventListener("keyup",o)}function c(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keyup",o)}var a="https://nomoreparties.co/v1/wff-cohort-42",u="8c3c178a-8043-434f-8729-e0f7e0c76d72",i="application/json";function l(){return fetch("".concat(a,"/cards"),{headers:{authorization:u}}).then(function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})}var s=document.querySelector(".profile__title"),d=document.querySelector(".profile__description"),p=document.querySelector(".profile__image"),f=document.querySelector(".profile__edit-button"),_=document.querySelector(".profile__add-button"),m=document.querySelector(".popup_type_edit"),y=document.querySelector(".popup_type_new-card"),v=document.querySelector(".popup_type_image"),h=document.querySelector(".popup_type_card-delete"),S=document.querySelector(".popup_type_change-avatar"),q=document.querySelectorAll(".popup"),C=v.querySelector(".popup__image"),b=v.querySelector(".popup__caption"),k=document.forms["edit-profile"],g=k.querySelector(".popup__input_type_name"),E=k.querySelector(".popup__input_type_description"),L=document.forms["new-place"],A=L.querySelector(".popup__input_type_card-name"),j=L.querySelector(".popup__input_type_url"),x=document.forms["change-avatar"],T=x.querySelector(".popup__input_type_change-avatar-link"),P=h.querySelector(".popup__button"),B=document.getElementById("card-template").content,z=document.querySelector(".places__list"),D={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type-error",errorClass:"popup__error_visible"},H={myId:"",idCardDel:""},I={deleteBtnHandler:function(t){H.idCardDel=t.target.closest(".card").getAttribute("data-card-id"),r(h)},likeBtnHandler:function(t){t.target.classList.toggle("card__like-button_is-active");var e=t.target.closest(".card").getAttribute("data-card-id");l().then(function(t){var n,o=Array.from(t).find(function(t){return t._id===e});o.likes.some(function(t){return t._id===H.myId})?function(t){return fetch("".concat(a,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:u,"Content-Type":i}}).then(function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})}(o._id).finally(w):(n=o._id,fetch("".concat(a,"/cards/likes/").concat(n),{method:"PUT",headers:{authorization:u,"Content-Type":i}}).then(function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).finally(w)}).catch(console.log)},imgClickHandler:function(t){var e=t.name,n=t.link;C.alt=e,b.textContent=e,C.src=n,r(v)}};function w(){l().then(function(t){!function(t,e,n,o,r){Array.from(e.children).forEach(function(t){return t.remove()}),t.forEach(function(t){var c=function(t,e,n,o){var r=o.deleteBtnHandler,c=o.likeBtnHandler,a=o.imgClickHandler,u=e.cloneNode(!0),i=u.querySelector(".card"),l=u.querySelector(".card__image"),s=u.querySelector(".card__title"),d=u.querySelector(".card__delete-button"),p=u.querySelector(".card__like-button"),f=u.querySelector(".card__like-counter");return i.setAttribute("data-card-id",t._id),f.textContent=t.likes.length,l.setAttribute("src",t.link),l.setAttribute("alt",t.name),s.textContent=t.name,d.addEventListener("click",r),p.addEventListener("click",c),l.addEventListener("click",function(){a(t)}),t.likes.some(function(t){return t._id===n.myId})&&p.classList.add("card__like-button_is-active"),t.owner._id!==n.myId&&d.remove(),u}(t,n,o,r);e.append(c)})}(t,z,B,H,I)}).catch(console.log)}fetch("".concat(a,"/users/").concat("me"),{headers:{authorization:u}}).then(function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}).then(function(t){p.style.backgroundImage="url('".concat(t.avatar,"')"),s.textContent=t.name,d.textContent=t.about,H.myId=t._id}).catch(console.log).finally(w),f.addEventListener("click",function(){g.value=s.textContent,E.value=d.textContent,n(k,D),r(m)}),p.addEventListener("click",function(){x.reset(),n(x,D),r(S)}),_.addEventListener("click",function(){L.reset(),n(L,D),r(y)}),P.addEventListener("click",function(){var t;(t=H.idCardDel,fetch("".concat(a,"/cards/").concat(t),{method:"DELETE",headers:{authorization:u,"Content-Type":i}}).then(function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch(console.log).finally(function(){w(),c(h)})}),q.forEach(function(t){!function(t){t.querySelector(".popup__close").addEventListener("click",function(){c(t)}),t.addEventListener("mousedown",function(e){e.target===e.currentTarget&&c(t)})}(t),t.classList.add("popup_is-animated")}),k.addEventListener("submit",function(t){t.preventDefault();var e=document.querySelector(".popup_is-opened"),n=g.value,o=E.value,r=k.querySelector(".popup__button");r.textContent="Сохранение...",function(t,e){return fetch("".concat(a,"/users/me"),{method:"PATCH",headers:{authorization:u,"Content-Type":i},body:JSON.stringify({name:t,about:e})}).then(function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})}(n,o).then(function(t){s.textContent=t.name,d.textContent=t.about,c(e),r.textContent="Сохранить"}).catch(console.log)}),L.addEventListener("submit",function(t){t.preventDefault();var e=document.querySelector(".popup_is-opened"),n=A.value,o=j.value,r=L.querySelector(".popup__button");r.textContent="Сохранение...",function(t,e){return fetch("".concat(a,"/cards"),{method:"POST",headers:{authorization:u,"Content-Type":i},body:JSON.stringify({name:t,link:e})}).then(function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})}(n,o).catch(console.log).finally(function(){w(),c(e),r.textContent="Сохранить"})}),x.addEventListener("submit",function(t){var e;t.preventDefault(),x.querySelector(".popup__button").textContent="Сохранение...",(e=T.value,fetch("".concat(a,"/users/me/avatar"),{method:"PATCH",headers:{authorization:u,"Content-Type":i},body:JSON.stringify({avatar:e})}).then(function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch(console.log).finally(function(){return location.reload()})}),function(n){Array.from(document.querySelectorAll(n.formSelector)).forEach(function(o){return function(n,o){var r=Array.from(n.querySelectorAll(o.inputSelector)),c=n.querySelector(o.submitButtonSelector);e(r,c,o),r.forEach(function(a){a.addEventListener("input",function(){!function(e,n,o){n.validity.valid?t(e,n,o):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),e.validity.patternMismatch?r.textContent=e.getAttribute("data-pattern-error"):r.textContent=n,r.classList.add(o.errorClass)}(e,n,n.validationMessage,o)}(n,a,o),e(r,c,o)})})}(o,n)})}(D)})();
//# sourceMappingURL=main.js.map